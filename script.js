const AUTH_KEY='susenka-auth-v1';
function getUser(){try{return JSON.parse(localStorage.getItem(AUTH_KEY))||null;}catch(e){return null;}}
function setUser(u){localStorage.setItem(AUTH_KEY,JSON.stringify(u));}
function requireAuth(){if(!getUser()){location.href='login.html';}}
function logout(){localStorage.removeItem(AUTH_KEY);location.href='login.html';}
function fillUser(){const el=document.getElementById('whoami');const u=getUser();if(el)el.textContent=u?('@'+u.username):'Nepřihlášen';}
function initAuthPage(){const f=document.getElementById('authForm');const t=document.getElementById('authTitle');const m=document.getElementById('modeToggle');let mode='login';function re(){const a=document.getElementById('switch');if(a)a.addEventListener('click',ev=>{ev.preventDefault();m.click();});}m.addEventListener('click',e=>{e.preventDefault();mode=(mode==='login')?'register':'login';t.textContent=(mode==='login')?'Přihlášení':'Registrace';document.getElementById('altText').innerHTML=(mode==='login')?'Nemáš účet? <a href=\"#\" id=\"switch\">Vytvořit</a>':'Už máš účet? <a href=\"#\" id=\"switch\">Přihlásit</a>';re();});re();f.addEventListener('submit',e=>{e.preventDefault();const u=(document.getElementById('username').value||'').trim();const p=document.getElementById('password').value||'';if(!u||!p){alert('Vyplň uživatelské jméno i heslo.');return;}const KEY='susenka-users-v1';let users={};try{users=JSON.parse(localStorage.getItem(KEY))||{};}catch(e){}if(mode==='register'){if(users[u]){alert('Uživatel už existuje.');return;}users[u]={password:p};localStorage.setItem(KEY,JSON.stringify(users));setUser({username:u});location.href='index.html';}else{if(!users[u]||users[u].password!==p){alert('Špatné jméno nebo heslo.');return;}setUser({username:u});location.href='index.html';}});}
function clickerInit(){const u=getUser();const key='susenka-clicker-'+(u?u.username:'guest');const el=id=>document.getElementById(id);let state={cookies:0};function load(){try{const raw=localStorage.getItem(key);if(raw){state={...state,...JSON.parse(raw)};}}catch(e){}render();}function save(){try{localStorage.setItem(key,JSON.stringify(state));}catch(e){}}function render(){el('count').textContent=Math.floor(state.cookies);}document.getElementById('cookieBtn').addEventListener('click',()=>{state.cookies+=1;render();});document.getElementById('saveBtn').addEventListener('click',save);document.getElementById('resetBtn').addEventListener('click',()=>{if(confirm('Resetovat hru?')){state={cookies:0};save();render();}});document.getElementById('exportBtn').addEventListener('click',()=>{const data=btoa(unescape(encodeURIComponent(JSON.stringify(state))));prompt('Skopíruj si svůj save:',data);});document.getElementById('importBtn').addEventListener('click',()=>{const data=prompt('Vlož svůj save:');if(!data)return;try{const obj=JSON.parse(decodeURIComponent(escape(atob(data))));state={...state,...obj};save();render();alert('Načteno!');}catch(e){alert('Neplatný save.');}});load();}
